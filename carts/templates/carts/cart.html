{% extends 'ecommerce/base.html' %}

{% block content %}

<h1>Shopping Cart</h1>
<div class="products">
    {% for product_entry in cart.products.all %}
    <div class="product">
        <div class="product-img">
            {% with product_gallery=product_entry.product.images.all|first %}
            <img src="{{ product_gallery.image.url }}">
            {% endwith %}
        </div>
        <div class="product-title">
            <h3>{{ product_entry.product.title }}</h3>
        </div>
        <div class="product_quantity">
            <span>{{ product_entry.quantity }}</span>
        </div>
        <div class="product_prices">
            {% if product_entry.product.discount_percentage != 0 %}
            <span class="price original-price"><del>{{ product_entry.product.price }}</del></span>
            <span class="discounted-price price">{{ product_entry.product.get_discounted_price }}</span>
            {% else %}
            <span class="price">{{ product.price }}</span>
            {% endif %}
        </div>
        <form action="{% url 'carts:delete_entry' %}" method="post">{% csrf_token %}
            <input type="number" name="product_key" value="{{product_entry.product.pk}}" hidden>
            <p><button>remove</button></p>
        </form>
    </div>
    {% endfor %}
    <div class="total-prices">
        <table>
            <tr>
                <td>SubTotal: </td>
                <td>{{ cart.subtotal }}</td>
            </tr>
            <tr>
                <td>Total: </td>
                <td>{{ cart.total }}</td>
            </tr>
        </table>
    </div>
    <div class="continue-shopping">
        <a href="{% url 'products:index' %}">Continue Shopping</a>>
    </div>
    <div class="checkout">
        <a href="{% url 'carts:checkout' %}">Checkout</a>
    </div>
</div>

{% endblock %}